<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>OmniauthCallbacksController</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/github.css" type="text/css" media="screen" />
<script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            <span class="type">Class</span> 
            OmniauthCallbacksController 
            
                <span class="parent">&lt; 
                    
                    Devise::OmniauthCallbacksController
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../files/app/controllers/omniauth_callbacks_controller_rb.html">app/controllers/omniauth_callbacks_controller.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p>Controller for handling OAuth callback requests.</p>

    </div>
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>G</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-github">github</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    


    


    <!-- Methods -->
        
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-github">
            
              <b>github</b>()
            
            <a href="../classes/OmniauthCallbacksController.html#method-i-github" name="method-i-github" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Following the Devise/Omniauth convention an action is provided for each
OAuth provider. Since this app only allows sign in through GitHub only the
<code>github</code> method is present.</p>

<p>This action will attempt to retrieve the user from the database or create
them if they don&#39;t exist. If the user is successfully retrieved or
created then the user is signed in and their OAuth token is added to the
session for use in later API calls made through the search service.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-github_source')" id="l_method-i-github_source">show</a>
                
              </p>
              <div id="method-i-github_source" class="dyn-source">
                <pre><span class="ruby-comment"># File app/controllers/omniauth_callbacks_controller.rb, line 11</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">github</span>
  <span class="ruby-ivar">@user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">from_omniauth</span>(<span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">&#39;omniauth.auth&#39;</span>])

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@user</span>.<span class="ruby-identifier">persisted?</span>
    <span class="ruby-identifier">sign_in_and_redirect</span> <span class="ruby-ivar">@user</span>, <span class="ruby-identifier">event</span><span class="ruby-operator">:</span> <span class="ruby-value">:authentication</span>

    <span class="ruby-identifier">session</span>[<span class="ruby-value">:github_oauth_token</span>] = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">&#39;omniauth.auth&#39;</span>].<span class="ruby-identifier">credentials</span>.<span class="ruby-identifier">token</span>

    <span class="ruby-identifier">set_flash_message</span>(<span class="ruby-value">:notice</span>, <span class="ruby-value">:success</span>, <span class="ruby-identifier">kind</span><span class="ruby-operator">:</span> <span class="ruby-string">&#39;GitHub&#39;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">is_navigational_format?</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">session</span>[<span class="ruby-string">&#39;devise.github_data&#39;</span>] = <span class="ruby-identifier">request</span>.<span class="ruby-identifier">env</span>[<span class="ruby-string">&#39;omniauth.auth&#39;</span>]

    <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">new_user_session_url</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                    </div>

    </div>
  </body>
</html>    